#!/bin/bash

CDEF='[0m'
CRED='[31;1m'
CGRN='[32;1m'
CBLU='[34;1m'

ADDFILE=
COMMIT=
ACTION=

if [[ -z "$@" ]]; then
	git status
	exit 0
fi

while [[ -n "$@" ]]; do
	ARG=$1
	shift

	case "$ARG" in
	-m)
		ACTION=commit
		COMMIT="$@"
		break
		;;
	-a)
		echo "No such option [$ARG]"
		exit 1
		;;
	*)
		if [[ -e "$ARG" ]]; then
			ADDFILE="$ADDFILE $ARG"
		else
			echo "No such file [$ARG]"
			exit 2
		fi
		;;
	esac
done

if [[ "$ACTION" = commit ]]; then
	git add $ADDFILE
	if [[ -z "$COMMIT" ]]; then
		git commit
	else
		git commit -m "$COMMIT"
	fi
else
	for cfile in $ADDFILE; do
		if [[ -d "$cfile" ]]; then
			echo "Skipping directory [$cfile]"
			continue
		fi
		git diff "$cfile" | sed -r -e 's//^[/g' -e "s/^(-.*)$/${CRED}\1${CDEF}/" -e "s/^(\+.*)$/${CGRN}\1${CDEF}/" -e "s/^(@@.+)$/${CBLU}\1${CDEF}/" | less -R
	done
fi
