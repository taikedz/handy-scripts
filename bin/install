#!/bin/bash

set -u

# Add the most common items

SERVERMODE=no

function printhelp {
cat <<EOHELP
If run as root, this script installs "af" or "yf" wrappers around apt (Ubuntu systems) or yum (dnf not yet supported) respectively

If run as a regular user, installs individual user items to \$HOME/bin and adds a line to \$HOME/.bashrc to ensure this diredctory is in PATH

Use -s or --server to enable server mode: Server mode does not install GUI tools for regular users, just CLI ones.
EOHELP
}

while [[ -n "$@" ]]; do
ARG="$1" ; shift
case "$ARG" in
-s|--server)
	SERVERMODE=yes
	;;
-h|--help)
	printhelp
	exit 0
	;;
*)
	echo "Unknown option $ARG"
	exit 1
	;;
esac

done

destdir=/usr/local/bin
if [[ $UID -ne 0 ]]; then
	destdir="$HOME/bin"
	mkdir -p "$destdir"
fi

if [[ ! "$SERVERMODE" = yes ]]; then
	cp bin/{launch,rotate-screen} "$destdir"
fi
cp bin/{secret,sendme,connect,gdiff} "$destdir"

if [[ $UID -ne 0 ]] && [[ $( grep 'label:ADDBIN' "$HOME/.bashrc" -c ) -lt 1 ]]; then
	echo 'PATH="$PATH:$HOME/bin" # label:ADDBIN' >> "$HOME/.bashrc"
	echo "Please log in again for changes to take effect."
fi
